{% extends "base.html" %}

{% load thumbnail %}
{% load tag_colors %}
{% load staticfiles %}

{% block title %}{{ page.record_id }}{% endblock %}

{% block bodyclass %}page-browser sb-r{% endblock %}

{% block content %}
<div id="page-browser">

  <div class="page-with-nav">
      {% with prev=page.prev_page %}
          {% if prev %}
              <div class="prev-page">
                  <a href="{% url 'page_browser' prev.record_id %}">Prev</a>
              </div>
          {% endif %}
      {% endwith %}

      <div class="page">
          {% thumbnail page.image "x500" format="PNG"  as scaled %}
              <svg xmlns="http://www.w3.org/2000/svg" version="1.1"
                   xmlns:xlink="http://www.w3.org/1999/xlink"
                   width="{{ scaled.width }}" height="{{ scaled.height }}"
                   viewBox="0 0 {{ page.image_width }} {{ page.image_height }}">

                  <image x="0" y="0" width="{{ page.image_width }}" height="{{ page.image_height }}"
                   xlink:href="{{ scaled.url }}" />

                  {% for pattern in patterns %}
                      <g>
                          <rect x="{{ pattern.bbox.x }}" y="{{ pattern.bbox.y }}"
                                width="{{ pattern.bbox.width }}" height="{{ pattern.bbox.height}}"
                                stroke="black" stroke-width="10" fill="none" pointer-events="all"
                                id="pattern-{{ pattern.id }}" class="page-svg-patttern"
                                  />

                          <!--
                          <polygon points="{{ pattern.shape }}"
                                stroke="black" stroke-width="10" fill="blue"
                                id="pattern-{{  pattern.id }}" />
                          -->
                      </g>
                  {% endfor %}
              </svg>
          {%  endthumbnail %}

      </div>

      {% with next=page.next_page %}
          {% if next %}
              <div class="next-page">
                  <a href="{% url 'page_browser' next.record_id %}">Next</a>
              </div>
          {% endif %}
      {% endwith %}
  </div>

  <div class="volume-dot-navigation">
    <ol>
      {% for page_rid in volume.page_record_ids %}
        <li {% if page.record_id == page_rid %} class="active" {% endif %}>
          <a href="{% url 'page_browser' page_rid %}">{% url 'page_browser' page_rid %}</a>
        </li>
      {% endfor %}
    </ol>
  </div>
</div>


<div class="volume-back">
  <a href="{% url "volume_detail" volume.record_id %}">View Volume</a>
</div>
{% endblock %}



{% block sidebar-right %}
  <div class="page-title">{{ page.record_id }}</div>
  <div class="pattern-count"><span class="count" >00</span> Total  Patterns</div>
  <div class="vect-count"><span class="count">00</span> Vectorized</div>


  <div class="patterns-vect">

  </div>


  <div class="page-meta">
    <dl>
      <dt>Collection Type</dt>
      <dd>{{ volume.category.name }}</dd>

      <dt>Manufactor / Location</dt>
      <dd>{{ volume.producer_name }} / {{ volume.producer_location }}</dd>

      <dt>Technique / Patterntype</dt>
      <dd>?? / ??</dd>

      <dt>Tags</dt>
      <dd>
        {{ "todo"|as_tag }} {{ "foo"|as_tag }} {{ "bar"|as_tag }}
      </dd>
    </dl>
  </div>

    {% for category in categories %}
        <div class="volume-cat">
            <div class="volume-cat name {% if volume.category == category %}active{% endif %}">
                <h2>Collection<br></h2>
                <p>{{ category.name }}</p>
            </div>

            <ul class="volume-list {% if volume.category != category %}hidden{% endif %}">
                {% for vol in category.volumes_ordered %}
                    <li class="volume">
                        <a {% if vol == volume  %}class="active" {% endif %}href="{% url "volume_detail" vol.record_id %}">
                            <span {% if vol == volume %}style="color:#00c2ff"{% endif %}>&#x25CF; </span>{{ vol.record_id }}
                        </a>
                    </li>
                    <br/>
                {% endfor %}
            </ul>
        </div>
    {% endfor %}
{% endblock %}



{% block root %}
{% for pattern in patterns %}
<div class="modal fade page-pattern modal-centered"
         id="pattern-{{ pattern.id }}-content"
         data-related-svg="pattern-{{ pattern.id }}"
         data-keyboard="true"  tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <!--
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-
          <h5 class="modal-title">Modal title</h5>
        </div>
        -->
        <div class="modal-body">

          <div class="pattern-image">
            <a href="#" class="pattern-link">
              <img src="{% static 'musterapp/img/more.png' %}" class="pattern-image-more">
              <img src="{% thumbnail pattern.image "450" %}" class="pattern-image-image">
            </a>
          </div>

          <table class="pattern-meta">
            <tr class="tags">
              <td>Tags</td>
              <td>
                {% for tag in pattern.tags.names %}
                  {{ tag|as_tag }}
                {% endfor %}
              </td>
            </tr>
            <tr class="status">
              <td>Status</td>
              <td>...</td>
            </tr>
          </table>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

{% endfor %}
{% endblock %}